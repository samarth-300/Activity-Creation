<template>
  <b>Related to</b>
  <div class="slds-form-element">
    
    <lightning-button-menu onselect={captureRelated}>
      <template for:each={relatedToItems} for:item="menuvalue" >                
        <lightning-menu-item 
            label={menuvalue.label}
            value={menuvalue.value}
            key={menuvalue.value}
            >
        </lightning-menu-item>
      </template>
    </lightning-button-menu>

    <div class="slds-form-element__control">
      <div class={containerClasses}>

        <div class={comboboxClasses}
          aria-expanded={showListbox}
          aria-haspopup="listbox"
          role="combobox">

          <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_left-right"
            role="none">
            <span if:true={record}
              class="slds-icon_container slds-icon-utility-search slds-input__icon slds-input__icon_left">

            </span>
            <span if:false={record}
              class="slds-icon_container slds-icon-utility-search slds-input__icon slds-input__icon_left">
              <lightning-icon
                size="x-small"
                icon-name="utility:search"></lightning-icon>
            </span>
            <input type="search"
              id="searchInput"
              class={inputClasses}
              value={inputValue}
              onkeyup={onKeyup}
              onfocus={setFocus}
              onblur={setFocus}
              minlength="3"
              
              autocomplete="off"
              aria-autocomplete="list"
              aria-controls="searchInput"
              role="textbox"
              required={required}
              placeholder="Search...">

            <button if:true={showClear}
              onclick={clearSelection}
              class="slds-button slds-button_icon slds-input__icon slds-input__icon_right"
              title="Remove selected option">
              <lightning-icon
                size="x-small"
                icon-name="utility:close"></lightning-icon>
              <span class="slds-assistive-text">Remove selected option</span>
            </button>
          </div>

          <div if:true={hasError} class="slds-form-element__help">
            {error.message}
          </div>

          <div class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid"
            role="listbox">

            <c-combobox
              records={records}
              first-field={firstField}
              onselected={handleSelected} >
            </c-combobox>

          </div>
        </div>
      </div>
    </div>
  </div>
</template>